#!/bin/bash
# Configuration command builder

# Build specifications
ENABLE_DEBUG=no
ENABLE_OPTIMIZE=yes
ENABLE_SHARED=no
ENABLE_STATIC=yes

# Compiler specifications
CC=mpicc
CXX=mpicxx
FC=mpif90
F77=mpif77
ENABLE_MPI=yes
ENABLE_FORTRAN=yes

# Installation specifications
PREFIX_INSTALL_PATH=$HOME/install/MOAB

#####################
### DO NOT MODIFY ###
#####################
HOSTNAME=`hostname`
INTERNAL_OPTIONS=""
if (test "x$ENABLE_DEBUG" != "xno"); then
	INTERNAL_OPTIONS="$INTERNAL_OPTIONS --enable-debug"
else
	INTERNAL_OPTIONS="$INTERNAL_OPTIONS --disable-debug"
fi
if (test "x$ENABLE_OPTIMIZE" != "xno"); then
	INTERNAL_OPTIONS="$INTERNAL_OPTIONS --enable-optimize"
else
	INTERNAL_OPTIONS="$INTERNAL_OPTIONS --disable-optimize"
fi
if (test "x$ENABLE_SHARED" != "xno"); then
	INTERNAL_OPTIONS="$INTERNAL_OPTIONS --enable-shared"
else
	INTERNAL_OPTIONS="$INTERNAL_OPTIONS --disable-shared"
fi
if (test "x$ENABLE_STATIC" != "xno"); then
	INTERNAL_OPTIONS="$INTERNAL_OPTIONS --enable-static"
else
	INTERNAL_OPTIONS="$INTERNAL_OPTIONS --disable-static"
fi

if (test "x$PREFIX_INSTALL_PATH" != "x"); then
	INTERNAL_OPTIONS="$INTERNAL_OPTIONS --prefix=$PREFIX_INSTALL_PATH"
fi

test "x$ENABLE_MPI" != "xyes" || INTERNAL_OPTIONS="$INTERNAL_OPTIONS --with-mpi"

INTERNAL_OPTIONS="$INTERNAL_OPTIONS CC=$CC CXX=$CXX"

if (test "x$ENABLE_FORTRAN" != "xno"); then
	INTERNAL_OPTIONS="$INTERNAL_OPTIONS FC=$FC F77=$F77"
else
	INTERNAL_OPTIONS="$INTERNAL_OPTIONS --disable-fortran"
fi

# PRESET CONFIGURATION COMMANDS
CONFIGURE_CMD="$PWD/configure "

case "$HOSTNAME" in
  *vesta*)  CONFIGURE_CMD="$CONFIGURE_CMD --host=powerpc64-bgq-linux $INTERNAL_OPTIONS --with-hdf5=/soft/libraries/hdf5/1.8.10/cnk-xl/current --with-pnetcdf=/soft/libraries/pnetcdf/current/cnk-xl/current --with-netcdf=/soft/libraries/netcdf/4.3.0-f4.2/cnk-xl/V1R2M0-20131211 --with-zlib=/soft/libraries/alcf/current/xl/ZLIB --with-parmetis=/soft/libraries/alcf/current/xl/PARMETIS --with-metis=/soft/libraries/alcf/current/xl/METIS" ;;
  *mira*)   CONFIGURE_CMD="$CONFIGURE_CMD --host=powerpc64-bgq-linux $INTERNAL_OPTIONS --with-hdf5=/soft/libraries/hdf5/1.8.10/cnk-xl/current --with-pnetcdf=/soft/libraries/pnetcdf/current/cnk-xl/current --with-netcdf=/soft/libraries/netcdf/4.3.0-f4.2/cnk-xl/V1R2M0-20131211 --with-zlib=/soft/libraries/alcf/current/xl/ZLIB --with-parmetis=/soft/libraries/alcf/current/xl/PARMETIS --with-metis=/soft/libraries/alcf/current/xl/METIS" ;;
  *)        CONFIGURE_CMD="$CONFIGURE_CMD $INTERNAL_OPTIONS" ;;
esac

# PRINT OUT INFORMATION
echo "###########################################"
echo "   Hostname: $HOSTNAME"
echo "###########################################"

echo "MOAB Install path      = $PREFIX_INSTALL_PATH"
echo "Enable debug info      = $ENABLE_DEBUG"
echo "Enable optimization    = $ENABLE_OPTIMIZE"
echo "Enable shared build    = $ENABLE_SHARED"
echo "Enable static build    = $ENABLE_STATIC"
echo "Enable MPI parallelism = $ENABLE_MPI"
echo "Enable Fortran support = $ENABLE_FORTRAN"
echo "Compilers: CC=$CC, CXX=$CXX, FC=$FC, F77=$F77"
echo ""
echo "Configure command to use:"
echo "-------------------------"
echo "$CONFIGURE_CMD"

# Done.
